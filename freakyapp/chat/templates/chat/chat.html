{% extends "main.html" %}

{% block content %}


<!-- <wrapper class="block max-w-2xl mx-auto my-10 px-6">

        <div id="chat_window" class="h-[80rem] fixed max-w-lg w-full flex flex-col bg-blue-200 rounded-2xl shadow-2xl relative p-1">
            <div class="flex justify-center text-emerald-400 bg-blue-200 p-2 sticky top-0 z-10">
                <span id="online-count" class="pr-1">3</span>online
            </div>

            <div id="chat_container" class="overflow-y-auto flex-1 max-h-[calc(100%-4rem)]">
                <ul id="chat_messages" class="flex flex-col justify-end gap-2 p-4">
                    {% for message in chat_messages reversed %}
                        {% include "chat/chat_message.html" %}
                    {% endfor %}
                </ul>
            </div>

            <div class="sticky bottom-0 z-10 p-2">
                <form id="chat_message_form" class="w-full"
                        hx-post="{% url 'chat' %}"
                        hx-target="#chat_messages"
                        hx-swap="beforeend"
                        _="on htmx:afterRequest reset() me">
                    {% csrf_token %}
                    {{ form.text }}
                </form>
            </div>
            
        </div> 

    </div>

</wrapper> -->


<div id="chat-container" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 container mx-auto">

    <div class="bg-white shadow-md rounded-lg w-2/4 h-[80vh] fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">

        <div class="p-4 border-b bg-blue-500 text-white rounded-t-lg flex justify-between items-center relative">
            <p class="text-lg font-semibold">Group Name</p>
            
            <p class="text-sm absolute bottom-1 left-1/2 transform -translate-x-1/2 ">3 Online</p>
        </div>
        

        <div id="chatbox" class="p-4 h-80 overflow-y-auto">
        <!-- Chat messages will be displayed here -->
        <div class="mb-2 ">
            <ul id="chat_messages" class="flex flex-col justify-end gap-2 p-4">
                {% for message in chat_messages reversed %}

                    {% include "chat/chat_message.html" %}

                {% endfor %}
            </ul>
        </div>
        </div>
        
        <div class="p-4 border-t">
            <!-- Chat input container -->
            <div class="relative">
                <form id="chat_message_form" 
                      class="flex"
                      hx-post="{% url 'chat' %}" 
                      hx-target="#chat_messages" 
                      hx-swap="beforeend" 
                      _="on htmx:afterRequest reset() me">
                      
                    {% csrf_token %}
                    
                    <!-- Input field -->
                    <input type="text" 
                           name="text" 
                           class="w-full px-3 py-2 pr-16 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                           placeholder="Type a message..." />
                    
                    <!-- Send button inside input -->
                    <button id="send-button" 
                            type="submit" 
                            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-500 text-white px-4 py-1 rounded hover:bg-blue-600 transition duration-300">
                        Send
                    </button>
                </form>
            </div>
        </div>
        
        

    </div>
</div>


{% endblock %} 

{% block extra_js %}

<script>
    // Function to scroll the chatbox to the bottom
    function scrollToBottom() {
        const chatbox = document.getElementById('chatbox');
        chatbox.scrollTop = chatbox.scrollHeight;
    }
    scrollToBottom();

    // Scroll to the bottom after new message is added
    document.addEventListener('htmx:afterSwap', (event) => {
        if (event.detail.target.id === 'chat_messages') {
            scrollToBottom();
        }
    });
</script>


 {% endblock %}